<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scytale Quest: Educational Edition</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>

    <div class="scanlines"></div>

    <div id="homeOverlay" class="overlay home-bg">
        <div class="home-card">
            <h1 class="glitch" data-text="SCYTALE QUEST">SCYTALE QUEST</h1>
            <div class="separator"></div>
            <p class="mission-text">
                SECURE TERMINAL ACCESS <br>
                <span class="auth-text">Authorization Required...</span>
            </p>
            <button class="action-btn btn-blue btn-pulse" style="font-size: 1.5rem; padding: 20px 60px;" onclick="bootSystem()">INITIALIZE MISSION</button>
            <p style="margin-top: 20px; font-size: 0.8rem; color: #475569;">v2.1.0 | SYSTEM READY</p>
        </div>
    </div>

    <div id="mainInterface" class="main-interface hidden">
        
        <div class="header-section">
            <div class="header-left">
                <div class="header-title" id="modTitle">MODULE 1: TRANSPOSITION</div>
                <div class="header-desc" id="modDesc">
                    The Scytale Cipher wraps a message around a rod. The diameter of the rod acts as the "Key" to scramble the letters.
                </div>
            </div>
            <div class="header-right">
                <div class="score-box">SCORE: <span id="scoreVal">0</span></div>
            </div>
        </div>

        <div class="nav-section">
            <button id="btnPrev" class="nav-btn invisible" onclick="changeStep(-1)"><span>▲</span> PREV</button>
            <button class="nav-btn btn-home" onclick="location.reload()"><span>⌂</span> RESET</button>
            <button id="btnNext" class="nav-btn dimmed" onclick="changeStep(1)"><span>▼</span> NEXT</button>
        </div>

        <div class="game-section">
            
            <div id="module1" class="module-container fade-in">
                <h2 class="section-title">Step 1: The Input</h2>
                <p class="instr" id="m1-instr1">Please input any secret string (message) below to begin.</p>
                
                <input type="text" id="plainInput" value="" class="cyber-input" placeholder="TYPE SECRET MESSAGE HERE..." onkeyup="checkInputStage()">
                
                <div id="m1-stage2" class="hidden-stage" style="opacity: 0.3; pointer-events: none; transition: 0.5s;">
                    <div style="margin: 20px 0; border-top: 1px dashed var(--border); width: 100%;"></div>
                    <h2 class="section-title">Step 2: The Key</h2>
                    <p class="instr">Now, adjust the <strong>Key Width</strong> (Slider) to see how the grid rearranges your text.</p>
                    
                    <div class="slider-wrapper">
                        <label>Grid Key (Width): <span id="keyVal" class="highlight">4</span></label>
                        <input type="range" id="gridSlider" min="2" max="8" value="4" oninput="updateScytale()">
                    </div>

                    <div id="gridContainer" class="grid-visualizer"></div>

                    <div class="label-text">ENCRYPTED OUTPUT</div>
                    <div class="cipher-display" id="cipherOutput">...</div>
                </div>
            </div>

            <div id="module2" class="module-container hidden">
                <h2 class="section-title">Data Integrity Lab</h2>
                <p class="instr">
                    Encryption hides the message, but <strong>Hashing</strong> protects it from tampering. 
                    A Hash is a unique "Digital Fingerprint" of your data.
                </p>
                
                <div class="cipher-display" id="integrityDisplay">...</div>
                
                <div class="btn-group">
                    <button class="action-btn btn-green" onclick="generateHash()">1. GENERATE SEAL</button>
                    <button class="action-btn btn-red" onclick="triggerAttack()">2. SIMULATE ATTACK</button>
                    <button class="action-btn btn-blue" onclick="verifyHash()">3. VERIFY INTEGRITY</button>
                </div>

                <div id="statusBox" class="status-box hidden"></div>
            </div>

            <div id="module3" class="module-container hidden">
                <h2 class="section-title">Final Certification</h2>
                <p class="instr">Prove your understanding of Transposition and Integrity to complete the mission.</p>
                <div class="quiz-container"></div> 
                <button class="action-btn btn-green hidden" id="finishBtn" onclick="finishGame()">COMPLETE MISSION</button>
            </div>
        </div>

        <div class="ai-section" id="aiSection">
            <div class="ai-header">
                <div id="aiAvatar" class="ai-avatar tutor">AI</div>
                <div class="ai-meta">
                    <span id="aiName">Lab Tutor</span>
                    <span class="status-dot">● Online</span>
                </div>
            </div>
            
            <div id="chatBox" class="chat-history">
                <div class="chat-msg ai tutor">System Online. Waiting for user input...</div>
            </div>
            
            <div class="ai-input-wrapper">
                <input type="text" id="userQuery" placeholder="Type 'help'..." onkeypress="handleUserChat(event)">
                <button onclick="sendUserChat()">→</button>
            </div>
        </div>

    </div>

    <div id="endOverlay" class="overlay hidden">
        <h1 class="success-title">MISSION COMPLETE</h1>
        <div class="end-card">
            <h3>Performance Report:</h3>
            <ul>
                <li>Transposition: <span class="pass">PASSED</span></li>
                <li>Integrity Check: <span class="pass">PASSED</span></li>
                <li>Exam Score: <span class="pass">100%</span></li>
            </ul>
            <button class="action-btn btn-home" onclick="location.reload()">REBOOT SYSTEM</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>